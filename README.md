# Portrait - ç”¨æˆ·æ•°æ®ç”»åƒæœåŠ¡

åŸºäºæ™ºèƒ½å¤–å‘¼ç³»ç»Ÿæ•°æ®æ„å»ºç”¨æˆ·è¡Œä¸ºç”»åƒçš„åç«¯æœåŠ¡ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“Š **å¤šç»´åº¦ç”»åƒ**: æ”¯æŒé€šè¯ç»Ÿè®¡ã€æ„å‘åˆ†å¸ƒã€æƒ…æ„Ÿåˆ†æã€é£é™©è¯„ä¼°ç­‰å¤šç»´åº¦ç”¨æˆ·ç”»åƒ
- ğŸ“… **çµæ´»å‘¨æœŸ**: æ”¯æŒæŒ‰è‡ªç„¶å‘¨ã€è‡ªç„¶æœˆã€è‡ªç„¶å­£åº¦ç»Ÿè®¡å±•ç¤º
- ğŸ“ˆ **è¶‹åŠ¿åˆ†æ**: æä¾›å¤šå‘¨æœŸè¶‹åŠ¿æ•°æ®ï¼Œæ”¯æŒæŸ±çŠ¶å›¾ç­‰å¯è§†åŒ–å±•ç¤º
- ğŸ¤– **LLM å¢å¼º**: é›†æˆå¤§æ¨¡å‹è¿›è¡Œæƒ…æ„Ÿåˆ†æå’Œé£é™©è¯†åˆ«
- â° **T+1 é¢„è®¡ç®—**: é‡‡ç”¨å®šæ—¶ä»»åŠ¡é¢„è®¡ç®—ï¼Œç¡®ä¿æŸ¥è¯¢æ€§èƒ½

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Python 3.11+
- **æ¡†æ¶**: FastAPI
- **æ•°æ®åº“**: PostgreSQL (ç”»åƒå­˜å‚¨) + MySQL (æºæ•°æ®åªè¯»)
- **ç¼“å­˜**: Redis
- **ä»»åŠ¡è°ƒåº¦**: APScheduler
- **å®¹å™¨åŒ–**: Docker

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£… uv (Python åŒ…ç®¡ç†å™¨)
curl -LsSf https://astral.sh/uv/install.sh | sh

# å…‹éš†é¡¹ç›®åè¿›å…¥ç›®å½•
cd potrait

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–
uv sync
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ç­‰ä¿¡æ¯
```

### 3. åˆå§‹åŒ–æ•°æ®åº“

```bash
# æ–¹å¼ä¸€: ä½¿ç”¨ Alembic è¿ç§»
uv run alembic upgrade head

# æ–¹å¼äºŒ: ä½¿ç”¨åˆå§‹åŒ–è„šæœ¬
uv run python scripts/init_db.py
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘ç¯å¢ƒ
uv run uvicorn src.main:app --reload --host 0.0.0.0 --port 8000

# æˆ–ç›´æ¥è¿è¡Œ
uv run python -m src.main
```

### 5. è®¿é—® API æ–‡æ¡£

- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## Docker éƒ¨ç½²

```bash
# ä½¿ç”¨ docker-compose å¯åŠ¨æ‰€æœ‰æœåŠ¡
cd docker
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f portrait-api
```

## é¡¹ç›®ç»“æ„

```
potrait/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                  # API æ¥å£å±‚
â”‚   â”‚   â”œâ”€â”€ v1/
â”‚   â”‚   â”‚   â”œâ”€â”€ periods.py    # å‘¨æœŸç®¡ç†æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ portrait.py   # ç”¨æˆ·ç”»åƒæ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ admin.py      # ç®¡ç†æ¥å£
â”‚   â”‚   â”œâ”€â”€ deps.py           # ä¾èµ–æ³¨å…¥
â”‚   â”‚   â””â”€â”€ router.py         # è·¯ç”±æ±‡æ€»
â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ config.py         # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ database.py       # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ models/               # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ portrait/         # ç”»åƒæ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ source/           # æºæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ schemas/              # Pydantic æ¨¡å¼
â”‚   â”œâ”€â”€ services/             # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ tasks/                # å®šæ—¶ä»»åŠ¡
â”‚   â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ main.py               # åº”ç”¨å…¥å£
â”œâ”€â”€ migrations/               # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ tests/                    # æµ‹è¯•
â”œâ”€â”€ docker/                   # Docker é…ç½®
â”œâ”€â”€ scripts/                  # è„šæœ¬
â”œâ”€â”€ pyproject.toml            # é¡¹ç›®é…ç½®
â””â”€â”€ README.md
```

## API æ¥å£

### å‘¨æœŸç®¡ç†

| æ¥å£ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/api/v1/periods` | GET | è·å–å¯é€‰å‘¨æœŸåˆ—è¡¨ |
| `/api/v1/periods/current` | GET | è·å–å½“å‰å‘¨æœŸ |

### ç”¨æˆ·ç”»åƒ

| æ¥å£ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/api/v1/portrait/{user_id}` | GET | è·å–ç”¨æˆ·ç”»åƒ |
| `/api/v1/portrait/summary` | GET | è·å–ç”»åƒæ±‡æ€» |
| `/api/v1/portrait/trend` | GET | è·å–è¶‹åŠ¿æ•°æ® |

### ç®¡ç†æ¥å£

| æ¥å£ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/api/v1/admin/status` | GET | è·å–ç³»ç»ŸçŠ¶æ€ |
| `/api/v1/admin/compute` | POST | æ‰‹åŠ¨è§¦å‘è®¡ç®— |

## æ•°æ®è¡¨è¯´æ˜

### ç”»åƒå­˜å‚¨ (PostgreSQL)

| è¡¨å | è¯´æ˜ |
|------|------|
| `call_record_enriched` | é€šè¯è®°å½•å¢å¼ºè¡¨ |
| `user_portrait_snapshot` | ç”¨æˆ·ç”»åƒå¿«ç…§è¡¨ |
| `period_registry` | å‘¨æœŸæ³¨å†Œè¡¨ |

### æºæ•°æ® (MySQL - åªè¯»)

| è¡¨å | è¯´æ˜ |
|------|------|
| `autodialer_task` | ä»»åŠ¡è¡¨ |
| `autodialer_call_record_{YYYY_MM}` | é€šè¯è®°å½•è¡¨ (æŒ‰æœˆåˆ†è¡¨) |
| `autodialer_call_record_detail_{YYYY_MM}` | é€šè¯è¯¦æƒ…è¡¨ (æŒ‰æœˆåˆ†è¡¨) |
| `autodialer_number_{task_uuid}` | å·ç è¡¨ (æŒ‰ä»»åŠ¡åˆ†è¡¨) |

## å¼€å‘æŒ‡å—

### è¿è¡Œæµ‹è¯•

```bash
uv run pytest tests/ -v
```

### ä»£ç æ ¼å¼åŒ–

```bash
uv run ruff check --fix .
uv run ruff format .
```

### ç”Ÿæˆè¿ç§»

```bash
uv run alembic revision --autogenerate -m "æè¿°"
```

## åç»­å¼€å‘è®¡åˆ’

- [ ] Phase 2: æ•°æ®æŠ½å–å±‚ (ETL)
- [ ] Phase 3: LLM åˆ†æå±‚
- [ ] Phase 4: ç”»åƒèšåˆå±‚
- [ ] Phase 5: å¯è§†åŒ–æ”¯æŒ
- [ ] Phase 6: ç”Ÿäº§éƒ¨ç½²ä¼˜åŒ–

## è®¸å¯è¯

MIT License

